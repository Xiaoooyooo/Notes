# 发布订阅模式

## 实现思路

1. 发布者
2. 订阅者，即给发布者定义一个列表，用于存放订阅者的回调函数。订阅者一旦订阅，则向该列表添加一个回调函数
3. 发布消息，发布者遍历订阅列表，依次执行回调

## 代码实现

```js
let publisher = {}		//定义一个发布者
publisher.subscriber = []		//订阅者回调函数
publisher.subscribe = function(fn){		//订阅者添加到订阅列表
    this.subscriber.push(fn)
}
publisher.publish = function(){		//发布消息
    this.subscriber.forEach(fn=>{
        fn.apply(null,[...arguments])
    })
}
```

上面的代码就是一个简单的发布订阅模式，现在向其中添加几个订阅者：

```js
publisher.subscribe(function(message){
    console.log(`我是第一个订阅者，我得到的消息是：${message}`)
})
publisher.subscribe(function(message){
    console.log(`我是第二个订阅者，我得到的消息是：${message}`)
})
publisher.subscribe(function(message){
    console.log(`我是第三个订阅者，我得到的消息是：${message}`)
})
```

上面的代码向发布者中添加了几个订阅者，接下来我们只需要通过发布者发布消息就行了：

```js
publisher.publish("Hello World!")
/**
 * 我是第一个订阅者，我得到的消息是：Hello World!
 * 我是第二个订阅者，我得到的消息是：Hello World!
 * 我是第三个订阅者，我得到的消息是：Hello World!
 */

publisher.publish("JavaScript is amazing!")
/**
 * 我是第一个订阅者，我得到的消息是：JavaScript is amazing!
 * 我是第二个订阅者，我得到的消息是：JavaScript is amazing!
 * 我是第三个订阅者，我得到的消息是：JavaScript is amazing!
 */
```

那么现在就有一个问题了，上面的代码中，无论发布者发布了什么消息，所有的订阅者都会收到响应。而我们有了一种新的需求，那就是订阅者只接受自己感兴趣的消息，其他的一律不接受。接下来进行代码改造：

```js
let publisher = {}
publisher.subscriber = {}	//此处改为一个对象，用于存放不同订阅类型的订阅者
publisher.subscribe = function(type,fn){	//此处修改为订阅时需要传入订阅的类型，用于分组
    if(this.subscriber[type]){
        this.subscriber[type].push(fn)
    }else{
        this.subscriber[type] = [fn]
    }
}
publisher.publish = function(type,message){	//相应的发布消息时也需要指明发布的消息类型
    this.subscriber[type].forEach(fn=>{
        fn.apply(null,[...arguments])
    })
}
```

上面就是已经改造完成的代码了，接下来我们添加几个订阅者试一下：

```js
publisher.subscribe('game',function(game){	//添加一个对game感兴趣的订阅者
    console.log(`我订阅的是game，收到的消息是：${game}`)
})
publisher.subscribe('movie',function(movie){	//添加一个对movie感兴趣的订阅者
    console.log(`我订阅的是movie，收到的消息是：${movie}`)
})
publisher.subscribe('sports',function(sports){	//添加一个对sports感兴趣的订阅者
    console.log(`我订阅的是sports，收到的消息是：${sports}`)
})
```

接下来试试发布消息：

```js
publisher.publish('game','有新的游戏资讯了！')
//我订阅的是game，收到的消息是：有新的游戏资讯了！

publisher.publish('movie','有新的电影上映了！')
//我订阅的是movie，收到的消息是：有新的电影上映了！

publisher.publish('sports','有新的运动会消息了！')
//我订阅的是sports，收到的消息是：有新的运动会消息了！
```

由此可见，上面的代码实现了某些消息只针对一部分订阅者发布